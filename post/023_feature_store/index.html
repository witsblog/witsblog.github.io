<!doctype html><!-- This site was created with Wowchemy. https://www.wowchemy.com --><!-- Last Published: March 6, 2025 --><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=generator content="Wowchemy 5.7.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Fira+Code&family=Lora&family=Work+Sans&family=Montserrat:wght@400;700&family=Roboto+Mono:wght@400;700&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Fira+Code&family=Lora&family=Work+Sans&family=Montserrat:wght@400;700&family=Roboto+Mono:wght@400;700&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><script src=/js/mathjax-config.js></script><link rel=stylesheet href=/css/vendor-bundle.min.047268c6dd09ad74ba54a0ba71837064.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/academicons@1.9.2/css/academicons.min.css integrity="sha512-KlJCpRsLf+KKu2VQa5vmRuClRFjxc5lXO03ixZt82HZUk41+1I0bD8KBSA0fY290ayMfWYI9udIqeOWSu1/uZg==" crossorigin=anonymous media=print onload='this.media="all"'><script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js integrity crossorigin=anonymous async></script><link rel=stylesheet href=/css/wowchemy.176e9a6c2874fb96332dfb10e8718f70.css><link rel=stylesheet href=/css/libs/chroma/github-dark.min.css title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=/css/libs/chroma/github-dark.min.css title=hl-dark media=print onload='this.media="all"' disabled><meta name=author content="Wit Sirawit"><meta name=description content="Recently, feature stores have become essential in the MLOps stack, providing a centralized platform to serve features across training and serving enironments. In this post, I will explore how to run a self-served feature store, leveraging an open source project Feast."><link rel=alternate hreflang=en-us href=https://witsblog.github.io/post/023_feature_store/><link rel=canonical href=https://witsblog.github.io/post/023_feature_store/><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu66cf44b0d2eab4dae9de00f68d847da7_1567_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu66cf44b0d2eab4dae9de00f68d847da7_1567_180x180_fill_lanczos_center_3.png><meta name=theme-color content="#2962ff"><meta property="twitter:card" content="summary_large_image"><meta property="twitter:image" content="https://witsblog.github.io/post/023_feature_store/featured.png"><meta property="og:site_name" content="Wit's Blog"><meta property="og:url" content="https://witsblog.github.io/post/023_feature_store/"><meta property="og:title" content="A Self-Served Feature Store with Feast | Wit's Blog"><meta property="og:description" content="Recently, feature stores have become essential in the MLOps stack, providing a centralized platform to serve features across training and serving enironments. In this post, I will explore how to run a self-served feature store, leveraging an open source project Feast."><meta property="og:image" content="https://witsblog.github.io/post/023_feature_store/featured.png"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2023-05-20T00:00:00+00:00"><meta property="article:modified_time" content="2023-05-20T00:00:00+00:00"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://witsblog.github.io/post/023_feature_store/"},"headline":"A Self-Served Feature Store with Feast","image":["https://witsblog.github.io/post/023_feature_store/featured.png"],"datePublished":"2023-05-20T00:00:00Z","dateModified":"2023-05-20T00:00:00Z","author":{"@type":"Person","name":"Wit Sirawit"},"publisher":{"@type":"Organization","name":"Wit's Blog","logo":{"@type":"ImageObject","url":"https://witsblog.github.io/media/icon_hu66cf44b0d2eab4dae9de00f68d847da7_1567_192x192_fill_lanczos_center_3.png"}},"description":"Recently, feature stores have become essential in the MLOps stack, providing a centralized platform to serve features across training and serving enironments. In this post, I will explore how to run a self-served feature store, leveraging an open source project Feast."}</script><title>A Self-Served Feature Store with Feast | Wit's Blog</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=e564b39dd369f617445db1b4dfc2489f><script src=/js/wowchemy-init.min.fe8634e7d00f14d07fb33caf14cc8e55.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=Close><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search class=form-control aria-label=Search...></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><div class="page-header header--fixed"><header><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Wit's Blog</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Wit's Blog</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/#posts><span>Posts</span></a></li><li class=nav-item><a class=nav-link href=/#about><span>About</span></a></li><li class=nav-item><a class=nav-link href=/#projects><span>Projects</span></a></li><li class=nav-item><a class=nav-link href=/#gallery><span>Gallery</span></a></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=Search><i class="fas fa-search" aria-hidden=true></i></a></li></ul></div></nav></header></div><div class=page-body><article class=article><div class="article-container pt-3"><h1>A Self-Served Feature Store with Feast</h1><div class=article-metadata><span class=article-date>May 20, 2023
</span><span class=middot-divider></span>
<span class=article-reading-time>5 min read</span></div></div><div class="article-header container featured-image-wrapper mt-4 mb-4" style=max-width:1200px;max-height:552px><div style=position:relative><img src=/post/023_feature_store/featured_hu19636095421403bb27dcb9e83604af8e_224458_1200x2500_fit_q75_h2_lanczos_3.webp width=1200 height=552 alt class=featured-image></div></div><div class="container-fluid docs"><div class="row flex-xl-nowrap"><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>Contents</a></li></ul><nav id=TableOfContents><ul><li><a href=#why>Why?</a></li><li><a href=#1-understanding-the-feature-store>1) Understanding the Feature Store</a></li><li><a href=#2-customizing-the-online-store>2) Customizing the Online Store</a><ul><li><a href=#21-default-grpc-feature-server>2.1) Default gRPC Feature Server</a></li><li><a href=#22-feast--scylladb>2.2) Feast + ScyllaDB</a></li><li><a href=#23-client-library-with-client-side-load-balancing>2.3) Client Library with Client Side Load Balancing</a></li></ul></li><li><a href=#references>References</a></li></ul></nav></div><div class=article-container><div class=article-style><br><p>Recently, feature stores have become essential in the MLOps stack, providing a centralized platform to serve features across training and serving enironments. In this post, I will explore how to run a self-served feature store, leveraging an open source project <a href=https://github.com/feast-dev/feast target=_blank rel=noopener>Feast</a>.</p><br><h2 id=why>Why?</h2><ul><li>In our team, we have an application that needs to retrieve features for some ML application. At the time there was no feature store provided by the platform team, so we had to roll our own version.</li><li>Although Feast&rsquo;s <a href=https://github.com/feast-dev/feast/tree/master/sdk/python target=_blank rel=noopener>Python SDK</a> already provides a default implementation to interact with various backed databases for the online store, however, in our production setting, most of our backend applications are written in JVM language. So we need a JVM client library that retrieves features from the feature store.</li></ul><br><h2 id=1-understanding-the-feature-store>1) Understanding the Feature Store</h2><p>In its simplest form, a <strong>feature store</strong> is a key-value store that stores computed features for retrieval. <a href=https://github.com/feast-dev/feast target=_blank rel=noopener>Feast</a> however is more like an ecosystem around a feature store; it consists of a few important components:</p><ul><li><strong>Registry</strong><ul><li>An object store of feature definitions and their metadata.</li></ul></li><li><strong>SDK</strong><ul><li>The library for interacting within the Feast ecosystem.</li><li>The client library for ingesting and retrieving features from a feature store.</li></ul></li><li><strong>Offline Store</strong><ul><li>The storage that stores the ingested data, which is used for producing training datasets.</li><li>It supports working with historical time-series feature.</li><li>This is backed by a different storage and compute engine, for example, Spark, BigQuery, etc.</li></ul></li><li><strong>Online Store</strong><ul><li>The storage that sores the lastest feature value, for online, low-latency retrieval.</li><li>This is usually backed by a low-latency database like Redis, Cassandra, etc.</li></ul></li><li><strong>Online Serving Service / Feature Server</strong><ul><li>The service that serves online features from the online store.</li></ul></li></ul><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=/images/post/023/01.png alt loading=lazy data-zoomable></div></div></figure></p><br><h2 id=2-customizing-the-online-store>2) Customizing the Online Store</h2><h3 id=21-default-grpc-feature-server>2.1) Default gRPC Feature Server</h3><p>The default feature server is implemented using the <a href=https://grpc.io/ target=_blank rel=noopener>gRPC</a> <a href=https://grpc.io/docs/what-is-grpc/introduction/ target=_blank rel=noopener>server</a>, starting with a Google dependency injection framework <a href=https://github.com/google/guice target=_blank rel=noopener>Guice</a>, that creates a <code>io.grpc.Server</code> instance.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ServingGuiceApplication</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kt>void</span><span class=w> </span><span class=nf>main</span><span class=p>(</span><span class=n>String</span><span class=o>[]</span><span class=w> </span><span class=n>args</span><span class=p>)</span><span class=w> </span><span class=kd>throws</span><span class=w> </span><span class=n>InterruptedException</span><span class=p>,</span><span class=w> </span><span class=n>IOException</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=n>Injector</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>Guice</span><span class=p>.</span><span class=na>createInjector</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>new</span><span class=w> </span><span class=n>ServingServiceV2Module</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>new</span><span class=w> </span><span class=n>RegistryConfigModule</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>new</span><span class=w> </span><span class=n>InstrumentationConfigModule</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>new</span><span class=w> </span><span class=n>ServerModule</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>new</span><span class=w> </span><span class=n>ApplicationPropertiesModule</span><span class=p>(</span><span class=n>args</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>Server</span><span class=w> </span><span class=n>server</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>i</span><span class=p>.</span><span class=na>getInstance</span><span class=p>(</span><span class=n>Server</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>server</span><span class=p>.</span><span class=na>start</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>server</span><span class=p>.</span><span class=na>awaitTermination</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>The main logic of the serving service is implemented in the <code>OnlineServingServiceV2</code> class that implements the gRPC service:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-proto data-lang=proto><span class=line><span class=cl><span class=kd>service</span> <span class=n>ServingService</span> <span class=p>{</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span>  <span class=c1>// Get online features synchronously.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>rpc</span> <span class=n>GetOnlineFeatures</span> <span class=p>(</span><span class=n>GetOnlineFeaturesRequest</span><span class=p>)</span> <span class=k>returns</span> <span class=p>(</span><span class=n>GetOnlineFeaturesResponse</span><span class=p>);</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=p>}</span><span class=err>
</span></span></span></code></pre></div><p>If we look at the constructor of this class, we will see that it uses an instance of <code>OnlineRetriever</code> to interact with the backed database:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>OnlineServingServiceV2</span><span class=w> </span><span class=kd>implements</span><span class=w> </span><span class=n>ServingServiceV2</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=kd>static</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Logger</span><span class=w> </span><span class=n>log</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>org</span><span class=p>.</span><span class=na>slf4j</span><span class=p>.</span><span class=na>LoggerFactory</span><span class=p>.</span><span class=na>getLogger</span><span class=p>(</span><span class=n>OnlineServingServiceV2</span><span class=p>.</span><span class=na>class</span><span class=p>);</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>Tracer</span><span class=o>&gt;</span><span class=w> </span><span class=n>tracerOptional</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>OnlineRetriever</span><span class=w> </span><span class=n>retriever</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>RegistryRepository</span><span class=w> </span><span class=n>registryRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>OnlineTransformationService</span><span class=w> </span><span class=n>onlineTransformationService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>private</span><span class=w> </span><span class=kd>final</span><span class=w> </span><span class=n>String</span><span class=w> </span><span class=n>project</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>// ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=nf>OnlineServingServiceV2</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>OnlineRetriever</span><span class=w> </span><span class=n>retriever</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>RegistryRepository</span><span class=w> </span><span class=n>registryRepository</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>OnlineTransformationService</span><span class=w> </span><span class=n>onlineTransformationService</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>String</span><span class=w> </span><span class=n>project</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>Optional</span><span class=o>&lt;</span><span class=n>Tracer</span><span class=o>&gt;</span><span class=w> </span><span class=n>tracerOptional</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=na>retriever</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>retriever</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=na>registryRepository</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>registryRepository</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=na>onlineTransformationService</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>onlineTransformationService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=na>project</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>project</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>this</span><span class=p>.</span><span class=na>tracerOptional</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>tracerOptional</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>// ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>This <code>OnlineServingServiceV2</code> class is created during the dependency injection and the type of the <code>OnlineRetriever</code> (and therefore the backed database) is selected at runtime. <mark>If we are to use a different database such as Cassandra, ScyllaDB, etc, as a backed database for the online store, we will have to implement the code here</mark>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>public</span><span class=w> </span><span class=kd>class</span> <span class=nc>ServingServiceV2Module</span><span class=w> </span><span class=kd>extends</span><span class=w> </span><span class=n>AbstractModule</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c1>// ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nd>@Provides</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=kd>public</span><span class=w> </span><span class=n>ServingServiceV2</span><span class=w> </span><span class=nf>registryBasedServingServiceV2</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>ApplicationProperties</span><span class=w> </span><span class=n>applicationProperties</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>RegistryRepository</span><span class=w> </span><span class=n>registryRepository</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=n>Tracer</span><span class=w> </span><span class=n>tracer</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=n>ServingServiceV2</span><span class=w> </span><span class=n>servingService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=kd>final</span><span class=w> </span><span class=n>ApplicationProperties</span><span class=p>.</span><span class=na>Store</span><span class=w> </span><span class=n>store</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>applicationProperties</span><span class=p>.</span><span class=na>getFeast</span><span class=p>().</span><span class=na>getActiveStore</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>OnlineRetriever</span><span class=w> </span><span class=n>retriever</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// TODO: Support more store types, and potentially use a plugin model here.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>switch</span><span class=w> </span><span class=p>(</span><span class=n>store</span><span class=p>.</span><span class=na>getType</span><span class=p>())</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c1>// ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>case</span><span class=w> </span><span class=n>REDIS</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>RedisClientAdapter</span><span class=w> </span><span class=n>redisClient</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>RedisClient</span><span class=p>.</span><span class=na>create</span><span class=p>(</span><span class=n>store</span><span class=p>.</span><span class=na>getRedisConfig</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>retriever</span><span class=w> </span><span class=o>=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=k>new</span><span class=w> </span><span class=n>RedisOnlineRetriever</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>applicationProperties</span><span class=p>.</span><span class=na>getFeast</span><span class=p>().</span><span class=na>getProject</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>redisClient</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=k>new</span><span class=w> </span><span class=n>EntityKeySerializerV2</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>applicationProperties</span><span class=p>.</span><span class=na>getFeast</span><span class=p>().</span><span class=na>getEntityKeySerializationVersion</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>break</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=c1>// ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=k>default</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>throw</span><span class=w> </span><span class=k>new</span><span class=w> </span><span class=n>RuntimeException</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>String</span><span class=p>.</span><span class=na>format</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;Unable to identify online store type: %s for Registry Backed Serving Service&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>store</span><span class=p>.</span><span class=na>getType</span><span class=p>()));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// ...</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>servingService</span><span class=w> </span><span class=o>=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=k>new</span><span class=w> </span><span class=n>OnlineServingServiceV2</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>retriever</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>registryRepository</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>onlineTransformationService</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>applicationProperties</span><span class=p>.</span><span class=na>getFeast</span><span class=p>().</span><span class=na>getProject</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>Optional</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=n>tracer</span><span class=p>));</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=n>servingService</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>}</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></div><p>This is the (incomplete) class diagram for <code>OnlineServingServiceV2</code>; it shows some important parts that we have to implement in order to customize the feature server:</p><div class=mermaid>classDiagram
class OnlineServingServiceV2 {
- OnlineRetriever retriever
- RegistryRepository registryRepository
- OnlineTransformationService onlineTransformationService
+ GetFeastServingInfoResponse getFeastServingInfo(...)
+ GetOnlineFeaturesResponse getOnlineFeatures(...)
}
class OnlineRetriever
class RegistryRepository {
- Registry registry
- RegistryFile registryFile
}
class OnlineTransformationService
class OnlineRetriever {
+ getOnlineFeatures(...)
}
class RedisOnlineRetriever
class CassandraOnlineRetriever
class RegistryFile {
+ getContent()
+ getContentIfModified()
}
class S3RegistryFile
class GSRegistryFile
OnlineServingServiceV2 o-- OnlineRetriever
OnlineServingServiceV2 o-- RegistryRepository
OnlineServingServiceV2 o-- OnlineTransformationService
RegistryRepository o-- RegistryFile
OnlineRetriever <|.. RedisOnlineRetriever
OnlineRetriever <|.. CassandraOnlineRetriever
RegistryFile <|.. S3RegistryFile
RegistryFile <|.. GSRegistryFile</div><br><h3 id=22-feast--scylladb>2.2) Feast + ScyllaDB</h3><p>We choose ScyllaDB for the online store.</p><p>With ScyllaDB, the schema looks like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>CREATE</span><span class=w> </span><span class=k>TABLE</span><span class=w> </span><span class=n>keyspace_name</span><span class=p>.</span><span class=n>feature_set</span><span class=w> </span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>entity_key</span><span class=w>      </span><span class=nb>TEXT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>feature_name</span><span class=w>    </span><span class=nb>TEXT</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>value</span><span class=w>           </span><span class=nb>BLOB</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>event_ts</span><span class=w>        </span><span class=k>TIMESTAMP</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>created_ts</span><span class=w>      </span><span class=k>TIMESTAMP</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>PRIMARY</span><span class=w> </span><span class=k>KEY</span><span class=w> </span><span class=p>((</span><span class=n>entity_key</span><span class=p>),</span><span class=w> </span><span class=n>feature_name</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span><span class=k>WITH</span><span class=w> </span><span class=n>CLUSTERING</span><span class=w> </span><span class=k>ORDER</span><span class=w> </span><span class=k>BY</span><span class=w> </span><span class=p>(</span><span class=n>feature_name</span><span class=w> </span><span class=k>ASC</span><span class=p>);</span><span class=w>
</span></span></span></code></pre></div><p>Scylla online retriever implementation</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// ScyllaOnlineRetriever</span><span class=w>
</span></span></span></code></pre></div><h3 id=23-client-library-with-client-side-load-balancing>2.3) Client Library with Client Side Load Balancing</h3><p>After setting up the gRPC <strong>feature server</strong>, we implement a JVM-based client library for retriving the features. The library integrates <strong>client-side load balancing</strong> to optimize for performance and to ensure low-latency responses.</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=/images/post/023/03.png alt loading=lazy data-zoomable></div></div></figure></p><p>In gRPC, client-side load balancing can be achieved by creating a Kubernetes <a href=https://kubernetes.io/docs/concepts/services-networking/service/#headless-services target=_blank rel=noopener>headless service</a> to expose all replicas as DNS entry, allowing the client to distribute requests across them:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>grpc-server-java-service</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>ClusterIP</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>server-grpc-java</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>clusterIP</span><span class=p>:</span><span class=w> </span><span class=l>None</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>50051</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>targetPort</span><span class=p>:</span><span class=w> </span><span class=m>50051</span><span class=w>
</span></span></span></code></pre></div><p>Then in the client library, we set:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>String</span><span class=w> </span><span class=n>target</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s>&#34;grpc-server-java-service.default.svc.cluster.local:50051&#34;</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>ManagedChannel</span><span class=w> </span><span class=n>channel</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Grpc</span><span class=p>.</span><span class=na>newChannelBuilder</span><span class=p>(</span><span class=n>target</span><span class=p>,</span><span class=w> </span><span class=n>InsecureChannelCredentials</span><span class=p>.</span><span class=na>create</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>.</span><span class=na>defaultLoadBalancingPolicy</span><span class=p>(</span><span class=s>&#34;round_robin&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>.</span><span class=na>build</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><p>To verify that client-side load balancing does actyally work, we first deploy a set of gRPC feature servers in a Kubernetes cluster with 3 replicas. Afterward, we deploy a client application that uses the client library to distribute requests across these replicas.</p><p><figure id=figure-4-pods-3-from-grpc-feature-server-1-from-client-code><div class="d-flex justify-content-center"><div class=w-100><img src=/images/post/023/04.png alt="4 pods; 3 from gRPC feature server, 1 from client code" loading=lazy data-zoomable></div></div><figcaption>4 pods; 3 from gRPC feature server, 1 from client code</figcaption></figure></p><p><figure id=figure-we-can-see-that-the-response-comes-from-3-different-pods-in-the-k8s-cluster><div class="d-flex justify-content-center"><div class=w-100><img src=/images/post/023/05.png alt="We can see that the response comes from 3 different pods in the k8s cluster" loading=lazy data-zoomable></div></div><figcaption>We can see that the response comes from 3 different pods in the k8s cluster</figcaption></figure></p><br><h2 id=references>References</h2><ul><li><a href=https://docs.feast.dev/ target=_blank rel=noopener>https://docs.feast.dev/</a></li><li><a href=https://grpc.io/ target=_blank rel=noopener>https://grpc.io/</a></li><li><a href=https://kubernetes.io/docs/concepts/services-networking/service/#headless-services target=_blank rel=noopener>https://kubernetes.io/docs/concepts/services-networking/service/#headless-services</a></li><li><a href=https://github.com/grpc/grpc/blob/master/doc/load-balancing.md target=_blank rel=noopener>https://github.com/grpc/grpc/blob/master/doc/load-balancing.md</a></li></ul><br></div><div class=article-tags><a class="badge badge-light" href=/tag/mlops/>MLOps</a>
<a class="badge badge-light" href=/tag/data-engineering/>Data Engineering</a></div><div class=share-box><ul class=share><li><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fwitsblog.github.io%2Fpost%2F023_feature_store%2F&amp;text=A+Self-Served+Feature+Store+with+Feast" target=_blank rel=noopener class=share-btn-twitter aria-label=twitter><i class="fab fa-twitter"></i></a></li><li><a href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Fwitsblog.github.io%2Fpost%2F023_feature_store%2F&amp;t=A+Self-Served+Feature+Store+with+Feast" target=_blank rel=noopener class=share-btn-facebook aria-label=facebook><i class="fab fa-facebook"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fwitsblog.github.io%2Fpost%2F023_feature_store%2F&amp;title=A+Self-Served+Feature+Store+with+Feast" target=_blank rel=noopener class=share-btn-linkedin aria-label=linkedin-in><i class="fab fa-linkedin-in"></i></a></li></ul></div></div></div></div></article></div><div class=page-footer><div class=container><footer class=site-footer></footer></div></div><script src=/js/vendor-bundle.min.938a3a7554cd9f6602290411f64d2617.js></script><script src=https://cdn.jsdelivr.net/npm/mermaid@10.9.1/dist/mermaid.min.js integrity="sha512-6a80OTZVmEJhqYJUmYd5z8yHUCDlYnj6q9XwB/gKOEyNQV/Q8u+XeSG59a2ZKFEHGTYzgfOQKYEBtrZV7vBr+Q==" crossorigin=anonymous title=mermaid></script><script id=search-hit-fuse-template type=text/x-template>
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script><script src=https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin=anonymous></script><script id=page-data type=application/json>{"use_headroom":true}</script><script src=/js/wowchemy-headroom.db4755770454eb63685f8de785c0a172.js type=module></script><script src=/en/js/wowchemy.min.2945731fa88332cb0ec33cf47d29879f.js></script></body></html>