<!doctype html><!-- This site was created with Wowchemy. https://www.wowchemy.com --><!-- Last Published: March 6, 2025 --><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=generator content="Wowchemy 5.7.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Fira+Code&family=Lora&family=Work+Sans&family=Montserrat:wght@400;700&family=Roboto+Mono:wght@400;700&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Fira+Code&family=Lora&family=Work+Sans&family=Montserrat:wght@400;700&family=Roboto+Mono:wght@400;700&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><script src=/js/mathjax-config.js></script><link rel=stylesheet href=/css/vendor-bundle.min.047268c6dd09ad74ba54a0ba71837064.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/academicons@1.9.2/css/academicons.min.css integrity="sha512-KlJCpRsLf+KKu2VQa5vmRuClRFjxc5lXO03ixZt82HZUk41+1I0bD8KBSA0fY290ayMfWYI9udIqeOWSu1/uZg==" crossorigin=anonymous media=print onload='this.media="all"'><script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js integrity crossorigin=anonymous async></script><link rel=stylesheet href=/css/wowchemy.176e9a6c2874fb96332dfb10e8718f70.css><link rel=stylesheet href=/css/libs/chroma/github-dark.min.css title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=/css/libs/chroma/github-dark.min.css title=hl-dark media=print onload='this.media="all"' disabled><meta name=author content="Wit Sirawit"><meta name=description content="Introduction This is the first-ever post of my blog; so I will give it a try. This post is about things that I went through when I tried to implement a simple monocular visual odometry from scratch."><link rel=alternate hreflang=en-us href=https://witsblog.github.io/post/001_visual_odometry/><link rel=canonical href=https://witsblog.github.io/post/001_visual_odometry/><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu66cf44b0d2eab4dae9de00f68d847da7_1567_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu66cf44b0d2eab4dae9de00f68d847da7_1567_180x180_fill_lanczos_center_3.png><meta name=theme-color content="#2962ff"><meta property="twitter:card" content="summary_large_image"><meta property="twitter:image" content="https://witsblog.github.io/post/001_visual_odometry/featured.png"><meta property="og:site_name" content="Wit's Blog"><meta property="og:url" content="https://witsblog.github.io/post/001_visual_odometry/"><meta property="og:title" content="Visual Odometry Implementation from Scratch | Wit's Blog"><meta property="og:description" content="Introduction This is the first-ever post of my blog; so I will give it a try. This post is about things that I went through when I tried to implement a simple monocular visual odometry from scratch."><meta property="og:image" content="https://witsblog.github.io/post/001_visual_odometry/featured.png"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2019-10-05T00:00:00+00:00"><meta property="article:modified_time" content="2019-10-05T00:00:00+00:00"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://witsblog.github.io/post/001_visual_odometry/"},"headline":"Visual Odometry Implementation from Scratch","image":["https://witsblog.github.io/post/001_visual_odometry/featured.png"],"datePublished":"2019-10-05T00:00:00Z","dateModified":"2019-10-05T00:00:00Z","author":{"@type":"Person","name":"Wit Sirawit"},"publisher":{"@type":"Organization","name":"Wit's Blog","logo":{"@type":"ImageObject","url":"https://witsblog.github.io/media/icon_hu66cf44b0d2eab4dae9de00f68d847da7_1567_192x192_fill_lanczos_center_3.png"}},"description":"Introduction This is the first-ever post of my blog; so I will give it a try. This post is about things that I went through when I tried to implement a simple monocular visual odometry from scratch."}</script><title>Visual Odometry Implementation from Scratch | Wit's Blog</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=89d8541ea0902255d1cdc0e0a36192ab><script src=/js/wowchemy-init.min.fe8634e7d00f14d07fb33caf14cc8e55.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=Close><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search class=form-control aria-label=Search...></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><div class="page-header header--fixed"><header><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>Wit's Blog</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>Wit's Blog</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/#posts><span>Posts</span></a></li><li class=nav-item><a class=nav-link href=/#about><span>About</span></a></li><li class=nav-item><a class=nav-link href=/#projects><span>Projects</span></a></li><li class=nav-item><a class=nav-link href=/#gallery><span>Gallery</span></a></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=Search><i class="fas fa-search" aria-hidden=true></i></a></li></ul></div></nav></header></div><div class=page-body><article class=article><div class="article-container pt-3"><h1>Visual Odometry Implementation from Scratch</h1><div class=article-metadata><span class=article-date>Oct 5, 2019
</span><span class=middot-divider></span>
<span class=article-reading-time>4 min read</span></div></div><div class="article-header container featured-image-wrapper mt-4 mb-4" style=max-width:1200px;max-height:845px><div style=position:relative><img src=/post/001_visual_odometry/featured_hube2d77684a47c7405e5ad785644615b5_89192_1200x2500_fit_q75_h2_lanczos_3.webp width=1200 height=845 alt class=featured-image></div></div><div class=article-container><div class=article-style><h2 id=introduction>Introduction</h2><p>This is the first-ever post of my blog; so I will give it a try. This post is about things that I went through when I tried to implement a simple monocular visual odometry from scratch. For a programming language, I choose MATLAB because it is easy-to-use and fast for prototyping a project.</p><p><em><strong>Disclaimer:</strong></em> This is not a state-of-the-art implementation. This simply serves the purpose of learning.</p><h2 id=the-problem>The Problem</h2><p>To give a general idea, visual odometry (VO) is an algorithm that aims to recover the path incrementally, by using the visual input from cameras, and hence the name. It can be considered as a sequential structure from motion, as opposed to hierarchical structure from motion. Imagine a robot or an agent, attached with a calibrated camera $C$, moves through an environment and receives the image continuously. The images
$I_k, I_{k-1}$ are taken at different time steps
$k$ and
$k-1$, which corresponds to the camera pose
$C_k$ and $C_{k-1}$ respectively. The task of VO is basically to retrieve the transformation matrix
$$T = \left[R \lvert t \right]$$ that relates two camera poses, and concatenate all the transformaitons
$T_k$ to get the current camera pose:</p>$$ C_{t} = T_{t,t-1}C_{t-1}$$<h2 id=getting-things-up--running>Getting Things Up & Running</h2><p>I first have an initialization function <code>vo_initialize.m</code> that takes two image frames, establishing keypoint correspondences between these two frames using KLT feature tracker, estimating relative camera pose, and finally triangulating an initial 3D point cloud landmarks. I admit that these may sound lacking of excitement (as they are something that is well understood in the computer vision community), but they are not easy to implement from scratch in a single sit.</p><h3 id=feature-detection>Feature Detection</h3><p>This is a simple plementation of Harris corner detector. For each pixel
$(u,v)$, we calculate a score</p>$$R = det(A_{u,v}) - {\lambda}trace^2(A_{u,v})$$<p>where</p>$$ A_{u,v} = \begin{bmatrix} \sum{I^2_{x}} & \sum{I_{x}I_{y}}\\ \sum{I_{x}I_{y}} & \sum{I^2_{y}} \end{bmatrix} $$
<p>and
$I_x, I_y$ are the image gradients in
$x$ and
$y$ direction respectively.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-matlab data-lang=matlab><span class=line><span class=cl><span class=n>I_x</span> <span class=p>=</span> <span class=n>conv2</span><span class=p>(</span><span class=n>img</span><span class=p>,</span> <span class=p>[</span><span class=o>-</span><span class=mi>1</span> <span class=mi>0</span> <span class=mi>1</span><span class=p>;</span> <span class=o>-</span><span class=mi>2</span> <span class=mi>0</span> <span class=mi>2</span><span class=p>;</span> <span class=o>-</span><span class=mi>1</span> <span class=mi>0</span> <span class=mi>1</span><span class=p>],</span> <span class=s>&#39;valid&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>I_y</span> <span class=p>=</span> <span class=n>conv2</span><span class=p>(</span><span class=n>img</span><span class=p>,</span> <span class=p>[</span><span class=o>-</span><span class=mi>1</span> <span class=o>-</span><span class=mi>2</span> <span class=o>-</span><span class=mi>1</span><span class=p>;</span> <span class=mi>0</span> <span class=mi>0</span> <span class=mi>0</span><span class=p>;</span> <span class=mi>1</span> <span class=mi>2</span> <span class=mi>1</span><span class=p>],</span> <span class=s>&#39;valid&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>I_xx</span> <span class=p>=</span> <span class=n>double</span><span class=p>(</span><span class=n>I_x</span><span class=o>.^</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>I_yy</span> <span class=p>=</span> <span class=n>double</span><span class=p>(</span><span class=n>I_y</span><span class=o>.^</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>I_xy</span> <span class=p>=</span> <span class=n>double</span><span class=p>(</span><span class=n>I_x</span><span class=o>.*</span><span class=n>I_y</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>I_xx_sum</span> <span class=p>=</span> <span class=n>conv2</span><span class=p>(</span><span class=n>I_xx</span><span class=p>,</span> <span class=nb>ones</span><span class=p>(</span><span class=n>patch_size</span><span class=p>),</span> <span class=s>&#39;valid&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>I_yy_sum</span> <span class=p>=</span> <span class=n>conv2</span><span class=p>(</span><span class=n>I_yy</span><span class=p>,</span> <span class=nb>ones</span><span class=p>(</span><span class=n>patch_size</span><span class=p>),</span> <span class=s>&#39;valid&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>I_xy_sum</span> <span class=p>=</span> <span class=n>conv2</span><span class=p>(</span><span class=n>I_xy</span><span class=p>,</span> <span class=nb>ones</span><span class=p>(</span><span class=n>patch_size</span><span class=p>),</span> <span class=s>&#39;valid&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>pad_size</span> <span class=p>=</span> <span class=nb>floor</span><span class=p>((</span><span class=n>patch_size</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>/</span><span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>scores</span> <span class=p>=</span> <span class=p>(</span><span class=n>I_xx_sum</span><span class=o>.*</span><span class=n>I_yy_sum</span> <span class=o>-</span> <span class=n>I_xy_sum</span><span class=o>.^</span><span class=mi>2</span><span class=p>)</span> <span class=o>-</span> <span class=n>lambda</span><span class=o>*</span><span class=p>(</span><span class=n>I_xx_sum</span> <span class=o>+</span> <span class=n>I_yy_sum</span><span class=p>)</span><span class=o>.^</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>scores</span><span class=p>(</span><span class=n>scores</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=n>scores</span> <span class=p>=</span> <span class=n>padarray</span><span class=p>(</span><span class=n>scores</span><span class=p>,</span> <span class=p>[</span><span class=n>pad_size</span> <span class=n>pad_size</span><span class=p>]);</span>
</span></span></code></pre></div><p>After calculating the score, we simply select
$k$ keypoints with highest scores (with non-maximum suppression).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-matlab data-lang=matlab><span class=line><span class=cl><span class=n>scores_pad</span> <span class=p>=</span> <span class=n>padarray</span><span class=p>(</span><span class=n>scores</span><span class=p>,</span> <span class=p>[</span><span class=n>r</span> <span class=n>r</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=n>score_size</span> <span class=p>=</span> <span class=nb>size</span><span class=p>(</span><span class=n>scores_pad</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>keypoints</span> <span class=p>=</span> <span class=nb>zeros</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=n>k</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=nb>i</span> <span class=p>=</span> <span class=mi>1</span><span class=p>:</span><span class=n>k</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=o>~</span><span class=p>,</span> <span class=n>idx</span><span class=p>]</span> <span class=p>=</span> <span class=n>max</span><span class=p>(</span><span class=n>scores_pad</span><span class=p>,</span> <span class=p>[],</span> <span class=s>&#39;all&#39;</span><span class=p>,</span> <span class=s>&#39;linear&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=n>row</span><span class=p>,</span> <span class=n>col</span><span class=p>]</span> <span class=p>=</span> <span class=nb>ind2sub</span><span class=p>(</span><span class=n>score_size</span><span class=p>,</span> <span class=n>idx</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>keypoints</span><span class=p>(:,</span> <span class=nb>i</span><span class=p>)</span> <span class=p>=</span> <span class=p>[</span><span class=n>row</span><span class=p>;</span> <span class=n>col</span><span class=p>]</span> <span class=o>-</span> <span class=n>r</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>scores_pad</span><span class=p>(</span><span class=n>row</span><span class=o>-</span><span class=n>r</span><span class=p>:</span><span class=n>row</span><span class=o>+</span><span class=n>r</span><span class=p>,</span> <span class=n>col</span><span class=o>-</span><span class=n>r</span><span class=p>:</span><span class=n>col</span><span class=o>+</span><span class=n>r</span><span class=p>)</span> <span class=p>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>end</span>
</span></span></code></pre></div><h3 id=klt-feature-tracker>KLT Feature Tracker</h3><p>&mldr;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-matlab data-lang=matlab></code></pre></div><h3 id=pose-estimation>Pose Estimation</h3><p>&mldr;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-matlab data-lang=matlab></code></pre></div><h3 id=triangulation>Triangulation</h3><p>&mldr;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-matlab data-lang=matlab></code></pre></div><p>The result of <code>vo_initialize.m</code> seems reasonable. Good to go!</p><p><figure><div class="d-flex justify-content-center"><div class=w-100><img src=/images/post/001/post.png alt loading=lazy data-zoomable></div></div></figure></p><h2 id=problems-from-previous-implementation>Problems from Previous Implementation</h2><p>&mldr;</p><h2 id=estimate-world-camera-pose>Estimate World Camera Pose</h2><p>&mldr;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-matlab data-lang=matlab></code></pre></div><h2 id=bundle-adjustment>Bundle Adjustment</h2><p>Bundle adjustment is a very cool concept. To put it simply, it is an optimization algorithm used to refine the estimated trajectory.</p><p>In this implementation, a <em>motion-only</em> bundle adjustment is implemented, which optimizes only the camera orientation $R$ and position $t$. This implies that</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-matlab data-lang=matlab></code></pre></div><h2 id=results>Results</h2><p>Putting it all together, the <code>vo_initialize.m</code> function initializes the VO pipeline, creating initial 3D point landmarks, extracting initial keypoints, and estimating the initial pose of the camera. The <code>vo_process.m</code> sequentially extracting and tracking image features from an image frame, across frames, and simultaneously estimating the pose of the camera. Bundle adjustment is also implemented to refine the estimated pose at each step. Lastly, new 3D points are regularly created as the number of currently tracked keypoints is shrinking over time. The following is the final result.</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/A5HnnSiZ_LM style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div><br><p>From the video, it is obvious that this is not a state-of-the-art implementation. There are various components that are not implemented. As we can see, the estimated trajectory starts to deviate from the ground truth after some time, due to the scale drift&ndash;a common problem in monocular VO. The estimated trajetory also wiggles slightly, probaly due to the fact that the full bundle adjustment is not implemented. And the most importantly, I did not try to implement a loop closure.</p><h2 id=reflections>Reflections</h2><p>The task of implementing VO from scratch may sound lacking of excitement. I believe that the conventional pipeline of VO and SLAM is something that is already well-understood in the computer vision community. What I realize is that academic papers usually have missing steps that are left for the readers to figure out. Here, I tried to connect those steps and the result stands as a self-assesment of my understanding.</p></div><div class=article-tags><a class="badge badge-light" href=/tag/robotics/>Robotics</a>
<a class="badge badge-light" href=/tag/computer-vision/>Computer Vision</a></div><div class=share-box><ul class=share><li><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fwitsblog.github.io%2Fpost%2F001_visual_odometry%2F&amp;text=Visual+Odometry+Implementation+from+Scratch" target=_blank rel=noopener class=share-btn-twitter aria-label=twitter><i class="fab fa-twitter"></i></a></li><li><a href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Fwitsblog.github.io%2Fpost%2F001_visual_odometry%2F&amp;t=Visual+Odometry+Implementation+from+Scratch" target=_blank rel=noopener class=share-btn-facebook aria-label=facebook><i class="fab fa-facebook"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fwitsblog.github.io%2Fpost%2F001_visual_odometry%2F&amp;title=Visual+Odometry+Implementation+from+Scratch" target=_blank rel=noopener class=share-btn-linkedin aria-label=linkedin-in><i class="fab fa-linkedin-in"></i></a></li></ul></div></div></article></div><div class=page-footer><div class=container><footer class=site-footer></footer></div></div><script src=/js/vendor-bundle.min.938a3a7554cd9f6602290411f64d2617.js></script><script id=search-hit-fuse-template type=text/x-template>
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script><script src=https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin=anonymous></script><script id=page-data type=application/json>{"use_headroom":true}</script><script src=/js/wowchemy-headroom.db4755770454eb63685f8de785c0a172.js type=module></script><script src=/en/js/wowchemy.min.2945731fa88332cb0ec33cf47d29879f.js></script></body></html>